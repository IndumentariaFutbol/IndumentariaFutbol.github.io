<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Indumentaria F√∫tbol</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* Reset b√°sicos */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      /* Colores inspirados en Canva con toque deportivo */
      --primary-color: #0d47a1; /* Azul oscuro - como un azul marino de uniforme */
      --secondary-color: #1976d2; /* Azul medio - vibrante, como el cielo */
      --accent-color: #ffc107; /* Amarillo oro - para acentos y cosas importantes */
      --light-bg: #e3f2fd; /* Fondo muy claro - como el aire en el campo */
      --card-bg: #fff; /* Fondo de tarjetas - limpio y blanco */
      --text-color: #212121; /* Texto oscuro - legible */
      --shadow-color: rgba(0, 0, 0, 0.1); /* Sombra suave */
      --gradient-start: #e3f2fd; /* Inicio del degradado del body */
      --gradient-end: #ffffff; /* Fin del degradado del body */
    }

    body {
      font-family: 'Poppins', sans-serif;
      /* Degradado sutil de fondo */
      background: linear-gradient(to bottom, var(--gradient-start), var(--gradient-end));
      color: var(--text-color);
      line-height: 1.6;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh; /* Asegura que el degradado ocupe toda la altura */
      position: relative; /* Necesario para el pseudo-elemento de fondo */
      overflow-x: hidden; /* Evita scroll horizontal en m√≥viles */
    }

    /* Pseudo-elemento para la imagen de fondo sutil */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('https://user-images.githubusercontent.com/97834575/157488099-a8c6a0c5-5a5c-4a3e-be98-a3d8b5a0b7e4.jpg'); /* Textura de campo de f√∫tbol */
      background-size: cover;
      background-position: center;
      opacity: 0.05; /* Muy sutil, para no distraer */
      z-index: -1; /* Asegura que est√© detr√°s de todo el contenido */
      pointer-events: none; /* Evita que bloquee eventos de clic */
    }

    h1 {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: 30px;
      font-size: 2.8em; /* Un poco m√°s grande */
      font-weight: 700;
      letter-spacing: 0.05em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1); /* Sombra m√°s pronunciada para el t√≠tulo */
      width: 100%;
      max-width: 900px;
    }

    .categoria,
    #carrito,
    #comprobante {
      background: var(--card-bg);
      border-radius: 12px; /* M√°s redondeado */
      padding: 25px; /* M√°s padding */
      margin-bottom: 25px;
      box-shadow: 0 8px 16px var(--shadow-color); /* Sombra m√°s pronounced */
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      width: 100%;
      max-width: 900px;
      border: 1px solid rgba(0,0,0,0.05); /* Borde sutil */
    }

    .categoria:hover {
      transform: translateY(-5px); /* Peque√±o levantamiento */
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15); /* Sombra m√°s grande al pasar el rat√≥n */
    }

    .categoria h2 {
      color: var(--secondary-color);
      font-size: 2em; /* Un poco m√°s grande */
      margin-bottom: 15px;
      border-bottom: 2px solid #e0e0e0; /* L√≠nea divisoria m√°s clara */
      padding-bottom: 10px;
      font-weight: 600;
      cursor: pointer; /* Indica que es clicable */
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .categoria h2::after {
      content: '‚ñº'; /* Flecha hacia abajo para indicar cerrado */
      font-size: 0.8em;
      transition: transform 0.3s ease;
    }

    .categoria.open h2::after {
      content: '‚ñ≤'; /* Flecha hacia arriba para indicar abierto */
      transform: rotate(180deg);
    }

    .productos {
      display: grid; /* Usamos Grid para el layout de los productos */
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Columnas responsivas */
      gap: 25px; /* Espacio entre productos */
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px dashed #e0e0e0; /* L√≠nea punteada sutil */
      /* Propiedades para colapsar/expandir */
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease-out; /* Transici√≥n suave */
    }

    .categoria.open .productos {
      max-height: 2000px; /* Suficientemente grande para contener los productos */
      transition: max-height 0.7s ease-in; /* Transici√≥n de apertura */
    }

    .producto {
      background: #fdfdfd; /* Blanco casi puro para productos */
      border-radius: 10px;
      display: flex;
      flex-direction: column; /* Apila elementos en columna */
      align-items: center; /* Centra horizontalmente */
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.08); /* Sombra suave para productos */
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      text-align: center; /* Centra el texto dentro del producto */
    }

    .producto:hover {
      transform: translateY(-3px); /* Ligeramente hacia arriba */
      box-shadow: 0 6px 12px rgba(0,0,0,0.12); /* Sombra ligeramente m√°s grande */
    }

    .producto img {
      width: 180px; /* Tama√±o de imagen m√°s grande */
      height: auto;
      border-radius: 8px;
      border: 3px solid var(--secondary-color); /* Borde distintivo */
      object-fit: cover;
      margin-bottom: 15px; /* Espacio debajo de la imagen */
    }

    .producto-info {
      flex: 1; /* Permite que la info del producto ocupe el espacio restante */
      min-width: 100%; /* Ocupa todo el ancho disponible */
      display: flex;
      flex-direction: column;
      gap: 10px; /* Espacio entre el span y el bot√≥n */
      justify-content: center; /* Centra verticalmente */
      align-items: center;
    }

    .producto-info span {
      font-weight: 700;
      font-size: 1.2em; /* Precio m√°s grande */
      color: var(--primary-color);
    }

    .producto button {
      background-color: var(--accent-color); /* Amarillo vibrante */
      color: var(--text-color); /* Texto oscuro para contraste */
      border: none;
      padding: 10px 20px;
      border-radius: 25px; /* Botones muy redondeados */
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
      font-size: 1em;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .producto button:hover {
      background-color: #ffb300; /* Un poco m√°s oscuro */
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    #carrito h2,
    #comprobante h2 {
      color: var(--secondary-color);
      font-size: 2em;
      margin-bottom: 15px;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 10px;
      font-weight: 600;
    }

    #listaCarrito {
        list-style: none;
        padding: 0;
        margin-bottom: 20px;
    }

    #listaCarrito li {
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      background-color: #f7f7f7; /* Fondo sutil para cada √≠tem del carrito */
      padding: 12px 18px;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.05);
      font-size: 1.05em;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    #listaCarrito li .item-details {
        flex-grow: 1;
        min-width: 180px;
        word-break: break-word;
        font-weight: 500;
        color: var(--text-color);
    }

    #listaCarrito button {
      background-color: #e53935; /* Rojo m√°s fuerte */
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      margin-left: 15px;
      cursor: pointer;
      transition: background 0.3s ease;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
      font-weight: normal; /* Bot√≥n de eliminar m√°s ligero */
    }
    #listaCarrito button:hover {
        background-color: #c62828; /* Rojo m√°s oscuro al hover */
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }


    /* Estilos para las notificaciones Toast */
    #toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column-reverse;
      align-items: flex-end;
    }

    .toast {
      background-color: #333;
      color: white;
      padding: 15px 30px; /* M√°s padding */
      border-radius: 10px; /* M√°s redondeado */
      margin-top: 12px;
      opacity: 0;
      transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
      transform: translateX(100%);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3); /* Sombra m√°s definida */
      max-width: 90%;
      text-align: center;
      font-weight: 600;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(0);
    }

    .toast.success { background-color: #4CAF50; }
    .toast.error { background-color: #f44336; }
    .toast.info { background-color: #2196F3; }

    label {
        font-weight: 600;
        margin-top: 15px;
        display: block;
        margin-bottom: 5px;
        color: var(--text-color);
    }

    input[type="text"],
    input[type="password"] {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1em;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.08);
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    input[type="text"]:focus,
    input[type="password"]:focus {
        border-color: var(--secondary-color);
        box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.2); /* Sombra de enfoque azul */
        outline: none;
    }

    /* Botones generales de la tienda (Aplicar descuento, Finalizar compra, Copiar CVU, Registrarse) */
    .button-group button { /* Usar una clase para agrupar */
      background-color: var(--primary-color); /* Azul oscuro para los botones principales */
      color: white;
      border: none;
      padding: 12px 25px;
      font-weight: 700;
      border-radius: 25px; /* Muy redondeado */
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      width: auto;
      display: inline-block;
      font-size: 1.05em;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      margin-top: 20px;
      margin-right: 10px; /* Espacio entre botones */
    }

    .button-group button:last-child {
        margin-right: 0;
    }
    .button-group button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
    }
    .button-group button:disabled:hover {
        background-color: #cccccc; /* No cambia al pasar el rat√≥n */
    }


    .button-group button:hover {
      background-color: #003b8e; /* Un azul m√°s oscuro */
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }

    #total,
    #totalDescuento,
    #totalPagado {
      font-weight: 700;
      color: var(--primary-color);
      font-size: 1.5em; /* M√°s grande */
      margin-top: 20px; /* M√°s espacio */
      display: block;
    }

    #totalDescuento {
        color: var(--accent-color); /* Color de acento para el total con descuento */
        font-size: 1.6em; /* A√∫n m√°s grande */
    }
    #totalPagado {
        font-size: 2em; /* Gran tama√±o para el total final */
        color: var(--secondary-color);
        margin-top: 25px;
    }

    /* Estilos para el formulario de registro simulado */
    #registroSimulado {
        background-color: #f0f8ff; /* Fondo m√°s claro para distinguirlo */
        border: 2px dashed var(--secondary-color);
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        margin-bottom: 20px;
        text-align: center;
    }
    #registroSimulado h3 {
        color: var(--primary-color);
        margin-bottom: 15px;
        font-size: 1.5em;
    }
    #registroSimulado button {
        background-color: #28a745; /* Bot√≥n de registro verde */
    }
    #registroSimulado button:hover {
        background-color: #218838;
    }

    /* Media Queries para una mejor adaptaci√≥n */
    @media (max-width: 768px) {
      body { padding: 15px; }
      h1 { font-size: 2.2em; margin-bottom: 25px; }
      .categoria, #carrito, #comprobante { padding: 20px; margin-bottom: 20px; border-radius: 10px; }
      .categoria h2, #carrito h2, #comprobante h2 { font-size: 1.6em; }
      .productos { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; }
      .producto { padding: 15px; border-radius: 8px; }
      .producto img { width: 150px; margin-bottom: 10px; }
      .producto-info span { font-size: 1.1em; }
      .producto button { padding: 8px 16px; font-size: 0.95em; border-radius: 20px; }
      #toast-container { right: 10px; left: 10px; align-items: center; }
      .toast { max-width: 100%; font-size: 0.9em; padding: 12px 25px; border-radius: 8px; }
      input[type="text"], input[type="password"], .button-group button { padding: 10px 18px; font-size: 0.95em; border-radius: 20px; }
      #listaCarrito li { font-size: 0.95em; padding: 10px 15px; border-radius: 6px; }
      #listaCarrito button { padding: 5px 9px; border-radius: 4px; }
      #total, #totalDescuento, #totalPagado { font-size: 1.3em; }
      #totalDescuento { font-size: 1.4em; }
      #totalPagado { font-size: 1.8em; }
      #registroSimulado h3 { font-size: 1.3em; }
    }

    @media (max-width: 480px) {
      body { padding: 10px; }
      h1 { font-size: 1.8em; margin-bottom: 20px; }
      .categoria h2, #carrito h2, #comprobante h2 { font-size: 1.4em; }
      .categoria, #carrito, #comprobante { padding: 15px; margin-bottom: 15px; border-radius: 8px; }
      .productos { grid-template-columns: 1fr; gap: 15px; } /* Una sola columna en m√≥viles peque√±os */
      .producto { padding: 12px; border-radius: 6px; }
      .producto img { width: 120px; margin-bottom: 8px; }
      .producto-info span { font-size: 1em; }
      .producto button { padding: 8px 14px; font-size: 0.9em; border-radius: 18px; }
      input[type="text"], input[type="password"], .button-group button { padding: 8px 15px; font-size: 0.9em; border-radius: 18px; display: block; margin-left: 0; margin-right: 0; width: 100%; } /* Botones y inputs ocupan todo el ancho */
      .button-group button + button { margin-top: 10px; } /* Espacio entre botones apilados */
      #listaCarrito li { font-size: 0.9em; padding: 8px 12px; border-radius: 5px; flex-direction: column; align-items: flex-start; } /* Apila √≠tems en carrito */
      #listaCarrito li .item-details { width: 100%; margin-bottom: 5px; }
      #listaCarrito button { padding: 4px 8px; border-radius: 3px; margin-left: 0; width: 100%; }
      #total, #totalDescuento, #totalPagado { font-size: 1.2em; }
      #totalDescuento { font-size: 1.3em; }
      #totalPagado { font-size: 1.6em; }
      #registroSimulado h3 { font-size: 1.2em; }
    }
  </style>
</head>
<body>
  <h1>Indumentaria F√∫tbol</h1>

  <div class="categoria" id="categoria-botines">
    <h2 onclick="toggleCategoria('categoria-botines')">Botines</h2>
    <div class="productos" id="productos-botines">
      <div class="producto">
        <img src="https://i0.wp.com/www.sitemarca.com/wp-content/uploads/2019/07/Nike-Mercurial-360-2019-8.jpg" alt="Nike Mercurial">
        <div class="producto-info">
          <span>Botines Nike Mercurial - $110.000</span>
          <button onclick="agregarAlCarrito('Botines Nike Mercurial', 110000, 'nike-mercurial')">Agregar</button>
        </div>
      </div>
      <div class="producto">
        <img src="https://assets.adidas.com/images/h_840,f_auto,q_auto,fl_lossy,c_fill,g_auto/6bf310c6ec0449c2b38c612751070302_9366/Botines_Predator_Elite_Terreno_Firme_Verde_IG8771_HM1.jpg" alt="Adidas Predator">
        <div class="producto-info">
          <span>Botines Adidas Predator - $125.000</span>
          <button onclick="agregarAlCarrito('Botines Adidas Predator', 125000, 'adidas-predator')">Agregar</button>
        </div>
      </div>
      <div class="producto">
        <img src="https://brunch.com.ar/wp-content/uploads/2021/04/IMG_7435-scaled.jpg" alt="Puma Future">
        <div class="producto-info">
          <span>Botines Puma Future - $95.000</span>
          <button onclick="agregarAlCarrito('Botines Puma Future', 95000, 'puma-future')">Agregar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="categoria" id="categoria-camisetas">
    <h2 onclick="toggleCategoria('categoria-camisetas')">Camisetas</h2>
    <div class="productos" id="productos-camisetas">
      <div class="producto">
        <img src="https://acdn-us.mitiendanube.com/stores/001/106/550/products/arg1-8c236e7773ecab0d2916638527231867-640-0.jpg" alt="Camiseta Argentina">
        <div class="producto-info">
          <span>Camiseta Argentina 2022 - $65.000</span>
          <button onclick="agregarAlCarrito('Camiseta Argentina 2022', 65000, 'camiseta-arg')">Agregar</button>
        </div>
      </div>
      <div class="producto">
        <img src="https://acdn-us.mitiendanube.com/stores/001/312/744/products/brasil-photoroom-a3a484bc3d2b5d7e0617252271407052-480-0.jpg" alt="Camiseta Brasil">
        <div class="producto-info">
          <span>Camiseta Brasil 2024 - $60.000</span>
          <button onclick="agregarAlCarrito('Camiseta Brasil 2024', 60000, 'camiseta-brasil')">Agregar</button>
        </div>
      </div>
      <div class="producto">
        <img src="https://acdn-us.mitiendanube.com/stores/006/105/140/products/3179c1e6-f624616f187c28128e17171953608769-1024-1024.jpg" alt="Camiseta Real Madrid">
        <div class="producto-info">
          <span>Camiseta Real Madrid 2024 - $70.000</span>
          <button onclick="agregarAlCarrito('Camiseta Real Madrid 2024', 70000, 'camiseta-rm')">Agregar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="categoria" id="categoria-pelotas">
    <h2 onclick="toggleCategoria('categoria-pelotas')">Pelotas</h2>
    <div class="productos" id="productos-pelotas">
      <div class="producto">
        <img src="https://assets.adidas.com/images/h_840,f_auto,q_auto,fl_lossy,c_fill,g_auto/25447a2fbfa045e39665af3800f13511_9366/Pelota_Oceaunz_Club_Blanco_H57805_01_standard.jpg" alt="Pelota Adidas Training">
        <div class="producto-info">
          <span>Pelota Adidas Training - $30.000</span>
          <button onclick="agregarAlCarrito('Pelota Adidas Training', 30000, 'pelota-adidas-training')">Agregar</button>
        </div>
      </div>
      <div class="producto">
        <img src="https://assets.adidas.com/images/h_840,f_auto,q_auto,fl_lossy,c_fill,g_auto/fc233e7589d84c6ea40aaf720087a324_9366/Pelota_de_Futbol_N%C2%B05_Rojo_HT2487_01_standard.jpg" alt="Pelota Adidas World Cup">
        <div class="producto-info">
          <span>Pelota Adidas World Cup - $40.000</span>
          <button onclick="agregarAlCarrito('Pelota Adidas World Cup', 40000, 'pelota-adidas-worldcup')">Agregar</button>
        </div>
      </div>
      <div class="producto">
        <img src="https://tienda.umbro.com.ar/media/catalog/product/cache/cf274d8520268e31ef407671175657b9/u/m/umbro_pelota-f_tbol_force-tango_rojo_frente.jpg" alt="Pelota Umbro Force">
        <div class="producto-info">
          <span>Pelota Umbro Force - $25.000</span>
          <button onclick="agregarAlCarrito('Pelota Umbro Force', 25000, 'pelota-umbro-force')">Agregar</button>
        </div>
      </div>
    </div>
  </div>


  <div id="carrito">
    <h2>Carrito de Compras</h2>
    <ul id="listaCarrito"></ul>
    <p><strong>Total:</strong> $<span id="total">0.00</span></p>

    <label for="codigo">C√≥digo de descuento:</label>
    <input type="text" id="codigo" placeholder="Escribe tu c√≥digo">
    <div class="button-group">
        <button onclick="aplicarDescuento()">Aplicar descuento</button>
    </div>

    <p><strong>Total con descuento:</strong> $<span id="totalDescuento">0.00</span></p>

    <div id="registroSimulado">
        <h3>Reg√≠strate para continuar con tu compra</h3>
        <label for="regNombre">Tu Nombre:</label>
        <input type="text" id="regNombre" placeholder="Ej: Juan P√©rez">
        <label for="regPassword">Crea una contrase√±a:</label>
        <input type="password" id="regPassword" placeholder="M√≠nimo 6 caracteres">
        <div class="button-group">
            <button onclick="simularRegistro()">Registrarme</button>
        </div>
    </div>

    <div id="seccionInstagram" style="display:none;">
        <label for="instagramCliente">Tu Usuario de Instagram (Ej: @tu_usuario):</label>
        <input type="text" id="instagramCliente" placeholder="Ej: @juan_perez_futbol">
    </div>


    <div class="button-group">
        <button id="btnFinalizarCompra" onclick="finalizarCompra()" disabled>Finalizar compra</button>
    </div>
  </div>

  <div id="comprobante" style="display: none;">
    <h2>Comprobante de Compra</h2>
    <p><strong>ID de Pedido:</strong> <span id="idPedidoComprobante"></span></p>
    <ul id="resumenCompra"></ul>
    <p><strong>Total Pagado:</strong> $<span id="totalPagado"></span></p>
    <p>Gracias por tu compra. Se ha enviado un comprobante al administrador.</p>
  </div>

  <form id="formularioCompra" action="https://formspree.io/f/mwpogygp" method="POST" style="display:none;">
    <input type="hidden" name="id_pedido" id="inputIdPedido"> <input type="hidden" name="resumen_pedido" id="inputResumen">
    <input type="hidden" name="total_final_pedido" id="inputTotal">
    <input type="hidden" name="nombre_cliente" id="inputNombreCliente"> <input type="hidden" name="instagram_cliente" id="inputInstagramCliente"> </form>

  <div id="toast-container"></div>

  <div style="margin-top: 30px; text-align: center;">
    <div class="button-group">
        <button onclick="copiarCVU()">Copiar CVU para pago</button>
    </div>
  </div>

  <script>
    let carrito = [];
    let totalBruto = 0; // Total sin descuentos
    let totalFinal = 0; // Total con descuentos aplicados
    let descuentoAplicado = { tipo: null, valor: 0, codigo: null }; // Para rastrear el descuento activo
    let openCategoryId = null; // Para controlar qu√© categor√≠a est√° abierta
    let nombreClienteRegistrado = ''; // Almacena el nombre una vez "registrado"

    // Estructura de productos para una mejor gesti√≥n y futuras expansiones
    const productosDisponibles = {
        'nike-mercurial': { nombre: 'Botines Nike Mercurial', precio: 110000 },
        'adidas-predator': { nombre: 'Botines Adidas Predator', precio: 125000 },
        'puma-future': { nombre: 'Botines Puma Future', precio: 95000 },
        'camiseta-arg': { nombre: 'Camiseta Argentina 2022', precio: 65000 },
        'camiseta-brasil': { nombre: 'Camiseta Brasil 2024', precio: 60000 },
        'camiseta-rm': { nombre: 'Camiseta Real Madrid 2024', precio: 70000 },
        'pelota-adidas-training': { nombre: 'Pelota Adidas Training', precio: 30000 },
        'pelota-adidas-worldcup': { nombre: 'Pelota Adidas World Cup', precio: 40000 },
        'pelota-umbro-force': { nombre: 'Pelota Umbro Force', precio: 25000 }
    };

    // C√≥digos de descuento con tipos: 'porcentaje' o 'fijo'
    const codigosDescuento = {
        // --- C√ìDIGO DE TESTEO ESPECIAL (solo para ti) ---
        "ERICESPECIAL$0": { tipo: 'especial_gratis', valor: 0 }, // Deja el total en 0

        // --- C√ìDIGOS NORMALES PARA CLIENTES ---
        "PRIMERACOMPRA": { tipo: 'porcentaje', valor: 15 }, // 15% de descuento en la primera compra
        "GANAGOL": { tipo: 'fijo', valor: 20000 }, // Descuento fijo de $20.000
        "OFERTA25": { tipo: 'porcentaje', valor: 25 }, // 25% de descuento
        "AMIGOS10": { tipo: 'porcentaje', valor: 10 } // 10% de descuento
    };

    const miCVU = "0000003100002113037276"; // ¬°CAMBIA ESTO POR TU CVU REAL!
    const instagramTiendaUsername = '@recargas_ff_express'; // Tu usuario de Instagram REAL. ¬°C√°mbialo si es diferente!
    const nombreTienda = 'Indumentaria F√∫tbol'; // Nombre de tu tienda. ¬°C√°mbialo si es diferente!

    // Lista de palabras ofensivas o no deseadas (M√ÅS ROBUSTA Y CON VARIACIONES)
    const palabrasProhibidas = [
        'puto', 'puta', 'putit', 'putaz',
        'mierda', 'mierdos',
        'gil', 'bolud', 'tonto', 'tarad', 'idio', 'estupid',
        'pito', 'pitos',
        'caca', 'cagar', 'cagad',
        'pene', 'penes',
        'vagina', 'vaginas',
        'concha', 'conchas',
        'trolo', 'trola',
        'maricon', 'maricona',
        'zorr',
        'forro', 'forra',
        'mufa', 'mufas',
        'bosta', 'bostas',
        'orto',
        'culo',
        'verga',
        'carajo',
        'choto', 'chota',
        'mogolico', 'mogolica', 'mogolicos',
        'pelotudo', 'pelotuda', 'pelotudez',
        'imbecil', 'mongol', 'cretino', 'pajera', 'pajero',
        'cojer', 'chupapija', 'chupapinga', 'sorete', 'gorila', 'desgraciado'
    ];


    // --- Funciones de Utilidad ---

    function showToast(message, type = 'info', duration = 3000) {
        const toastContainer = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        toastContainer.appendChild(toast);

        setTimeout(() => {
            toast.classList.add('show');
        }, 10);

        setTimeout(() => {
            toast.classList.remove('show');
            toast.addEventListener('transitionend', () => toast.remove());
        }, duration);
    }

    // Nueva funci√≥n para el manejo de categor√≠as colapsables
    function toggleCategoria(categoryId) {
        const targetCategory = document.getElementById(categoryId);

        if (targetCategory.classList.contains('open')) {
            // Si la categor√≠a ya est√° abierta, la cerramos
            targetCategory.classList.remove('open');
            openCategoryId = null;
        } else {
            // Si hay otra categor√≠a abierta, la cerramos primero
            if (openCategoryId && openCategoryId !== categoryId) {
                document.getElementById(openCategoryId).classList.remove('open');
            }
            // Abrimos la categor√≠a clicada
            targetCategory.classList.add('open');
            openCategoryId = categoryId;
        }
    }

    function agregarAlCarrito(nombre, precio, idProducto) {
        const itemExistente = carrito.find(item => item.id === idProducto);

        if (itemExistente) {
            itemExistente.cantidad++;
            itemExistente.subtotal = itemExistente.cantidad * itemExistente.precio;
        } else {
            carrito.push({ id: idProducto, nombre, precio, cantidad: 1, subtotal: precio });
        }
        actualizarCarrito();
        showToast(`"${nombre}" a√±adido al carrito!`, 'success');
    }

    function eliminarDelCarrito(idProducto) {
        const itemIndex = carrito.findIndex(item => item.id === idProducto);

        if (itemIndex > -1) {
            if (carrito[itemIndex].cantidad > 1) {
                carrito[itemIndex].cantidad--;
                carrito[itemIndex].subtotal = carrito[itemIndex].cantidad * carrito[itemIndex].precio;
            } else {
                carrito.splice(itemIndex, 1);
            }
            actualizarCarrito();
            showToast('Producto eliminado del carrito.', 'info');
        }
    }

    function actualizarCarrito() {
        const lista = document.getElementById('listaCarrito');
        lista.innerHTML = '';
        totalBruto = 0;

        carrito.forEach(item => {
            const li = document.createElement('li');
            li.innerHTML = `
                <div class="item-details">
                    ${item.nombre} (x${item.cantidad}) - $${item.subtotal.toLocaleString('es-AR')}
                </div>
                <div>
                    <button onclick="eliminarDelCarrito('${item.id}')">X</button>
                </div>
            `;
            lista.appendChild(li);
            totalBruto += item.subtotal;
        });

        document.getElementById('total').textContent = totalBruto.toLocaleString('es-AR');
        aplicarDescuento(true); // Recalcular totalFinal al actualizar el carrito

        // Habilitar o deshabilitar finalizar compra si el carrito est√° vac√≠o y no hay registro
        const btnFinalizar = document.getElementById('btnFinalizarCompra');
        if (carrito.length === 0 || !nombreClienteRegistrado) {
            btnFinalizar.disabled = true;
        } else {
            btnFinalizar.disabled = false;
        }
    }

    function aplicarDescuento(recalcular = false) {
        const codigoInput = document.getElementById('codigo');
        const codigo = codigoInput.value.trim().toUpperCase();
        const descuentoInfo = codigosDescuento[codigo];

        let mensajeDescuento = '';
        let tipoMensaje = 'info';

        if (!recalcular) {
            if (descuentoInfo) {
                descuentoAplicado = { tipo: descuentoInfo.tipo, valor: descuentoInfo.valor, codigo: codigo };
                if (descuentoInfo.tipo === 'especial_gratis') {
                    mensajeDescuento = `¬°Descuento especial "${codigo}" utilizado! Valor: $0`;
                } else {
                    mensajeDescuento = `C√≥digo "${codigo}" aplicado correctamente.`;
                }
                tipoMensaje = 'success';
            } else if (codigo === "" && descuentoAplicado.codigo) {
                descuentoAplicado = { tipo: null, valor: 0, codigo: null };
                mensajeDescuento = 'Descuento reseteado.';
                tipoMensaje = 'info';
            } else {
                descuentoAplicado = { tipo: null, valor: 0, codigo: null };
                mensajeDescuento = 'C√≥digo de descuento inv√°lido o no encontrado.';
                tipoMensaje = 'error';
            }
            showToast(mensajeDescuento, tipoMensaje);
        }

        let tempTotal = totalBruto;
        if (descuentoAplicado.tipo === 'porcentaje') {
            tempTotal = totalBruto - (totalBruto * descuentoAplicado.valor / 100);
        } else if (descuentoAplicado.tipo === 'fijo') {
            tempTotal = totalBruto - descuentoAplicado.valor;
        } else if (descuentoAplicado.tipo === 'especial_gratis') {
            tempTotal = 0;
        }
        totalFinal = Math.max(0, tempTotal);

        document.getElementById('totalDescuento').textContent = totalFinal.toLocaleString('es-AR');
    }

    // Funci√≥n para generar un ID de pedido √∫nico
    function generarIdPedido() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        const random = Math.floor(Math.random() * 9000) + 1000;

        return `PEDIDO-${year}${month}${day}-${hours}${minutes}${seconds}-${random}`;
    }

    // Funci√≥n de validaci√≥n de palabras ofensivas MEJORADA
    function contienePalabrasProhibidas(texto) {
        // Normalizar el texto: a min√∫sculas y sin acentos
        let textoNormalizado = texto.toLowerCase()
                                   .normalize("NFD").replace(/[\u0300-\u036f]/g, ""); // Remueve acentos

        for (const palabra of palabrasProhibidas) {
            // Usamos .includes() para una detecci√≥n m√°s permisiva de subcadenas
            if (textoNormalizado.includes(palabra)) {
                return true;
            }
        }
        return false;
    }

    function simularRegistro() {
        const regNombreInput = document.getElementById('regNombre');
        const regPasswordInput = document.getElementById('regPassword');
        const btnFinalizar = document.getElementById('btnFinalizarCompra');
        const seccionInstagram = document.getElementById('seccionInstagram');
        const registroSimuladoDiv = document.getElementById('registroSimulado');

        const nombre = regNombreInput.value.trim();
        const password = regPasswordInput.value.trim();

        if (nombre === '') {
            showToast('Por favor, ingresa tu nombre para registrarte.', 'error');
            regNombreInput.focus();
            return;
        }
        // Validar nombre con palabras prohibidas
        if (contienePalabrasProhibidas(nombre)) {
            showToast('El nombre ingresado contiene palabras no permitidas. Por favor, s√© respetuoso.', 'error');
            regNombreInput.focus();
            return;
        }
        if (password.length < 6) {
            showToast('La contrase√±a debe tener al menos 6 caracteres.', 'error');
            regPasswordInput.focus();
            return;
        }

        // Si todo es v√°lido, "registramos"
        nombreClienteRegistrado = nombre; // Guardamos el nombre para usarlo m√°s tarde
        showToast(`¬°Hola ${nombreClienteRegistrado}! Te has "registrado" exitosamente. Ahora puedes finalizar tu compra.`, 'success', 5000);

        // Ocultar el formulario de registro y mostrar el campo de Instagram
        registroSimuladoDiv.style.display = 'none';
        seccionInstagram.style.display = 'block';

        // Habilitar el bot√≥n de finalizar compra si ya hay productos en el carrito
        if (carrito.length > 0) {
            btnFinalizar.disabled = false;
        }
    }


    function finalizarCompra() {
        if (carrito.length === 0) {
            showToast('El carrito est√° vac√≠o. Agrega productos para finalizar la compra.', 'error');
            return;
        }

        if (!nombreClienteRegistrado) {
            showToast('Debes "registrarte" antes de finalizar la compra.', 'error');
            // Opcional: mostrar de nuevo la secci√≥n de registro
            document.getElementById('registroSimulado').style.display = 'block';
            document.getElementById('seccionInstagram').style.display = 'none';
            return;
        }

        const instagramClienteInput = document.getElementById('instagramCliente');
        let instagramCliente = instagramClienteInput.value.trim();

        // Validaciones para Instagram
        if (instagramCliente === '') {
            showToast('Por favor, ingresa tu usuario de Instagram.', 'error');
            instagramClienteInput.focus();
            return;
        }
         // Validar Instagram con palabras prohibidas
         if (contienePalabrasProhibidas(instagramCliente)) {
            showToast('El usuario de Instagram ingresado contiene palabras no permitidas. Por favor, s√© respetuoso.', 'error');
            instagramClienteInput.focus();
            return;
        }
        // Asegurarse de que el usuario de Instagram comience con '@'
        if (!instagramCliente.startsWith('@')) {
            instagramCliente = '@' + instagramCliente;
        }


        const idPedido = generarIdPedido();

        const resumen = document.getElementById('resumenCompra');
        resumen.innerHTML = '';
        let resumenTexto = '';

        carrito.forEach(item => {
            const li = document.createElement('li');
            li.textContent = `${item.nombre} (x${item.cantidad}) - $${item.subtotal.toLocaleString('es-AR')}`;
            resumen.appendChild(li);
            // Formatear para el mensaje de Instagram con guiones
            resumenTexto += `- ${item.nombre} (x${item.cantidad}) - $${item.subtotal.toLocaleString('es-AR')}\n`;
        });

        aplicarDescuento(true);
        document.getElementById('totalPagado').textContent = totalFinal.toLocaleString('es-AR');
        document.getElementById('idPedidoComprobante').textContent = idPedido;

        // 1. Preparar el NUEVO mensaje para Instagram DM y Copiado (Desde la perspectiva del COMPRADOR)
        let instagramMessage = `¬°Hola ${instagramTiendaUsername}! üëã Acabo de realizar una compra en ${nombreTienda}.\n\n`;
        instagramMessage += `Mi nombre es ${nombreClienteRegistrado} y mi usuario de Instagram es ${instagramCliente}.\n\n`;
        instagramMessage += `El ID de mi pedido es: #${idPedido}\n\n`;
        instagramMessage += `Resumen de la compra:\n${resumenTexto}\n`;
        instagramMessage += `El total final es: $${totalFinal.toLocaleString('es-AR')}\n\n`;
        instagramMessage += `¬°Espero tu mensaje para coordinar el pago y el env√≠o!`;


        const instagramURL = `https://ig.me/m/${instagramTiendaUsername.replace('@', '')}`; // Asegurarse de quitar el @ para la URL

        // 2. Enviar a Formspree (comprobante por Gmail)
        const formularioCompra = document.getElementById('formularioCompra');
        document.getElementById('inputIdPedido').value = idPedido;
        document.getElementById('inputResumen').value = `Pedido de ${nombreTienda}:\n\nID del Pedido: ${idPedido}\n\n${resumenTexto}\nTotal final: $${totalFinal.toLocaleString('es-AR')}\n\nNombre Cliente: ${nombreClienteRegistrado}\nInstagram Cliente: ${instagramCliente}`;
        document.getElementById('inputTotal').value = totalFinal.toLocaleString('es-AR');
        document.getElementById('inputNombreCliente').value = nombreClienteRegistrado; // Asignar al campo oculto
        document.getElementById('inputInstagramCliente').value = instagramCliente; // Asignar al campo oculto

        // Copiar el mensaje a Instagram autom√°ticamente (antes de la redirecci√≥n de Formspree)
        navigator.clipboard.writeText(instagramMessage).then(() => {
            showToast('¬°Mensaje del pedido copiado! P√©galo en Instagram para confirmar tu compra. Te contactaremos pronto. ‚úÖ', 'success', 5000);
        }).catch(err => {
            console.error('Error al copiar el mensaje a Instagram:', err);
            showToast('No se pudo copiar el mensaje autom√°ticamente. Por favor, haz una captura de pantalla del comprobante y cont√°ctanos por Instagram DM.', 'error', 7000); // Mensaje alternativo
        });

        // Redirigir a Instagram en una nueva pesta√±a (para que el usuario lo tenga listo)
        setTimeout(() => {
            window.open(instagramURL, '_blank');
        }, 2000);

        // Mostrar comprobante en la p√°gina (antes de que la p√°gina se redirija)
        document.getElementById('comprobante').style.display = 'block';

        // Limpiar carrito (tambi√©n antes de la redirecci√≥n)
        carrito = [];
        descuentoAplicado = { tipo: null, valor: 0, codigo: null };
        document.getElementById('codigo').value = '';
        document.getElementById('instagramCliente').value = ''; // Limpiar campo de Instagram

        // Restablecer el estado del registro para una nueva compra
        nombreClienteRegistrado = '';
        document.getElementById('regNombre').value = '';
        document.getElementById('regPassword').value = '';
        document.getElementById('registroSimulado').style.display = 'block'; // Volver a mostrar el registro
        document.getElementById('seccionInstagram').style.display = 'none'; // Ocultar Instagram de nuevo
        document.getElementById('btnFinalizarCompra').disabled = true; // Deshabilitar finalizar compra

        actualizarCarrito(); // Esto tambi√©n deshabilitar√° el bot√≥n si el carrito queda vac√≠o
        // (ya lo est√° haciendo la l√≠nea anterior, pero por si acaso)

        // Finalmente, env√≠a el formulario a Formspree, lo que causar√° la redirecci√≥n de la P√ÅGINA ACTUAL
        formularioCompra.submit();
    }

    function copiarCVU() {
        navigator.clipboard.writeText(miCVU).then(() => {
            showToast('CVU copiado al portapapeles ‚úÖ', 'success');
        }).catch(err => {
            showToast('No se pudo copiar el CVU. Por favor, c√≥pialo manualmente.', 'error');
        });
    }

    // Inicializar el carrito y cerrar todas las categor√≠as al cargar la p√°gina
    document.addEventListener('DOMContentLoaded', () => {
        actualizarCarrito();
        const categorias = document.querySelectorAll('.categoria');
        categorias.forEach(cat => {
            cat.classList.remove('open');
        });

        // Deshabilitar el bot√≥n de finalizar compra al inicio
        document.getElementById('btnFinalizarCompra').disabled = true;
        // Ocultar la secci√≥n de Instagram al inicio
        document.getElementById('seccionInstagram').style.display = 'none';
    });
  </script>
</body>
</html>
